!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],e):"object"==typeof exports?exports.cartIconController=e(require("lodash")):t.cartIconController=e(t._)}("undefined"!=typeof self?self:this,(function(t){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="https://static.parastorage.com/services/wixstores-client-cart-icon/1.711.0/",r(r.s=20)}([function(t,e,r){"use strict";r.r(e),r.d(e,"__extends",(function(){return i})),r.d(e,"__assign",(function(){return o})),r.d(e,"__rest",(function(){return a})),r.d(e,"__decorate",(function(){return s})),r.d(e,"__param",(function(){return c})),r.d(e,"__metadata",(function(){return u})),r.d(e,"__awaiter",(function(){return f})),r.d(e,"__generator",(function(){return d})),r.d(e,"__createBinding",(function(){return p})),r.d(e,"__exportStar",(function(){return l})),r.d(e,"__values",(function(){return h})),r.d(e,"__read",(function(){return b})),r.d(e,"__spread",(function(){return g})),r.d(e,"__spreadArrays",(function(){return _})),r.d(e,"__await",(function(){return y})),r.d(e,"__asyncGenerator",(function(){return S})),r.d(e,"__asyncDelegator",(function(){return v})),r.d(e,"__asyncValues",(function(){return m})),r.d(e,"__makeTemplateObject",(function(){return T})),r.d(e,"__importStar",(function(){return C})),r.d(e,"__importDefault",(function(){return O})),r.d(e,"__classPrivateFieldGet",(function(){return I})),r.d(e,"__classPrivateFieldSet",(function(){return E}));var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function i(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(t,n[i])&&(r[n[i]]=t[n[i]])}return r}function s(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a}function c(t,e){return function(r,n){e(r,n,t)}}function u(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function f(t,e,r,n){return new(r||(r=Promise))((function(i,o){function a(t){try{c(n.next(t))}catch(t){o(t)}}function s(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((n=n.apply(t,e||[])).next())}))}function d(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function p(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}function l(t,e){for(var r in t)"default"===r||e.hasOwnProperty(r)||(e[r]=t[r])}function h(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function b(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(b(arguments[e]));return t}function _(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;var n=Array(t),i=0;for(e=0;e<r;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}function y(t){return this instanceof y?(this.v=t,this):new y(t)}function S(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){i[t]&&(n[t]=function(e){return new Promise((function(r,n){o.push([t,e,r,n])>1||s(t,e)}))})}function s(t,e){try{(r=i[t](e)).value instanceof y?Promise.resolve(r.value.v).then(c,u):f(o[0][2],r)}catch(t){f(o[0][3],t)}var r}function c(t){s("next",t)}function u(t){s("throw",t)}function f(t,e){t(e),o.shift(),o.length&&s(o[0][0],o[0][1])}}function v(t){var e,r;return e={},n("next"),n("throw",(function(t){throw t})),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,i){e[n]=t[n]?function(e){return(r=!r)?{value:y(t[n](e)),done:"return"===n}:i?i(e):e}:i}}function m(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=h(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,i){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,i,(e=t[r](e)).done,e.value)}))}}}function T(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function C(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function O(t){return t&&t.__esModule?t:{default:t}}function I(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function E(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}},,function(t,e,r){"use strict";r.d(e,"a",(function(){return p})),r.d(e,"k",(function(){return n})),r.d(e,"l",(function(){return i})),r.d(e,"c",(function(){return o})),r.d(e,"j",(function(){return s})),r.d(e,"g",(function(){return c})),r.d(e,"d",(function(){return f})),r.d(e,"f",(function(){return l})),r.d(e,"i",(function(){return h})),r.d(e,"e",(function(){return b})),r.d(e,"m",(function(){return g})),r.d(e,"b",(function(){return _})),r.d(e,"h",(function(){return y}));var n,i,o,a,s,c,u,f,d,p="1380b703-ce81-ff05-f115-39571d94dfcd";!function(t){t.CART_ICON="1380bbc4-1485-9d44-4616-92e36b1ead6b",t.PRODUCT_PAGE="13a94f09-2766-3c40-4a32-8edb5acdd8bc",t.PRODUCT_WIDGET="13ec3e79-e668-cc0c-2d48-e99d53a213dd",t.GALLERY_PAGE="1380bba0-253e-a800-a235-88821cf3f8a4",t.GRID_GALLERY="13afb094-84f9-739f-44fd-78d036adb028",t.SLIDER_GALLERY="139a41fd-0b1d-975f-6f67-e8cbdf8ccc82",t.THANK_YOU_PAGE="1380bbb4-8df0-fd38-a235-88821cf3f8a4",t.ADD_TO_CART="14666402-0bc7-b763-e875-e99840d131bd",t.WISHLIST_PAGE="a63a5215-8aa6-42af-96b1-583bfd74cff5",t.CART="1380bbab-4da3-36b0-efb4-2e0599971d14"}(n||(n={})),function(t){t.CART_COMMANDS_URL="/_api/wix-ecommerce-renderer-web/store-front/cart/{commandName}",t.READ_WRITE_GRAPHQL_URL="_api/wix-ecommerce-graphql-web/api",t.STOREFRONT_GRAPHQL_URL="_api/wix-ecommerce-storefront-web/api",t.WISHLIST_BASE_URL="/_api/wishlist-server"}(i||(i={})),function(t){t[t.MINI_CART=1]="MINI_CART",t[t.CART=2]="CART",t[t.NONE=3]="NONE"}(o||(o={})),function(t){t[t.IDLE=0]="IDLE",t[t.SUCCESSFUL=1]="SUCCESSFUL",t[t.FAILED=2]="FAILED"}(a||(a={})),function(t){t.CART="shopping_cart",t.CHECKOUT="checkout",t.GALLERY="product_gallery",t.THANKYOU="thank_you_page",t.PRODUCT="product_page",t.ORDER_HISTORY="order_history",t.WISHLIST="wishlist"}(s||(s={})),function(t){t.GET_CONFIG="getConfig",t.MULTI_LANG="multiLang",t.MINICART_OPEN="miniCartOpen"}(c||(c={})),function(t){t.RELATED_PRODUCTS="relatedProductIds"}(u||(u={})),function(t){t.AddToCart="add to cart",t.BuyNow="buy now",t.Subscribe="subscribe"}(f||(f={})),function(t){t.USE_LIGHTBOXES="specs.stores.UseLightboxes"}(d||(d={}));var l="x-wix-currency",h="x-wix-linguist",b="X-XSRF-TOKEN",g="https://8bc29fb6cd064a49a9945743de020bf2@sentry.io/1186457",_="https://settings.parastorage.com",y="https://ecom.wix.com/storefront/cartwidgetPopup"},function(e,r){e.exports=t},,function(t,e,r){"use strict";r.d(e,"c",(function(){return i})),r.d(e,"a",(function(){return o})),r.d(e,"b",(function(){return a}));var n=r(9);function i(t,e){return t.replace(/\{\{([^}]+)\}\}/gi,(function(t,r){return e[r.trim()]||""}))}function o(t){return fetch(t,{method:"get"}).then((function(t){return t.json()})).catch((function(e){throw new n.a("Could not fetch translation",{originalError:e.message,path:t})}))}function a(){return"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope}},function(t,e,r){"use strict";r.d(e,"b",(function(){return i})),r.d(e,"a",(function(){return o})),r.d(e,"d",(function(){return a})),r.d(e,"e",(function(){return s})),r.d(e,"c",(function(){return n}));var n,i="00000000-000000-000000-000000000000",o="wixstores-cart-icon",a=function(t,e){return void 0===e&&(e="en"),t+"assets/locale/cartIcon/cartIcon_"+e+".json"},s={stores:{USE_LIGHTBOXES:"specs.stores.UseLightboxes"}};!function(t){t.ADD_TO_CART="add-to-cart",t.ADD_ITEMS_TO_CART="add-items-to-cart"}(n||(n={}))},function(t,e,r){"use strict";r.d(e,"d",(function(){return c})),r.d(e,"c",(function(){return u})),r.d(e,"f",(function(){return f})),r.d(e,"e",(function(){return d})),r.d(e,"b",(function(){return p})),r.d(e,"a",(function(){return l}));var n,i=r(0),o=r(3),a=r.n(o),s=!1;function c(t){n=t}var u=function(t){throw null==n||n.captureException(t),t};function f(t){return d(u)(t)}function d(t){return function(e){var r,n=(r=t,function(t){return function(){try{return s?Promise.resolve(t.apply(null,arguments)).catch(r):t.apply(null,arguments)}catch(t){null==r||r(t)}}});return a.a.reduce(e,(function(t,e,r){var o;return Object(i.__assign)(Object(i.__assign)({},t),((o={})[r]=a.a.isFunction(e)?n(e):e,o))}),{})}}function p(){return function(t){return a.a.noop}}function l(t,e,r){return function(n){var i=t.monitoring.createMonitor(n,(function(t){return t.environment="Worker",t}));return i.setUserContext(e),function(t,e){throw i.setExtraContext(t),r.fetchAdapter.getHistory().forEach((function(t){var e=a.a.omit(t.data.rawResponse,"headers");i.captureBreadcrumb({message:"Fetch "+t.url,category:"http",type:"http",data:{body:JSON.stringify(t.data.body).substr(0,100),errors:t.data.rawResponse.errors,response:JSON.stringify(e).substr(0,300),status:t.data.rawResponse.status,headers:t.data.headers}})})),i.captureException(t,e),i.setExtraContext(),console.error(t),t}}}},,function(t,e,r){"use strict";r.d(e,"a",(function(){return i}));var n=r(0),i=function(t){function e(e,r){var n=t.call(this,e)||this;return n.data=r,n.name="FetchError",n}return Object(n.__extends)(e,t),e}(Error)},,,,,function(t,e,r){"use strict";r.d(e,"a",(function(){return n}));var n=function(){function t(t){this.pubSub=t,this.subscribers={}}return t.prototype.subscribe=function(t,e,r){void 0===r&&(r=!1);var n=this.pubSub.subscribe(t,e,r);return this.subscribers[t]||(this.subscribers[t]=[]),this.subscribers[t].push(n),n},t.prototype.publish=function(t,e,r){void 0===r&&(r=!1),this.pubSub.publish(t,e,r)},t.prototype.unsubscribe=function(t,e){this.subscribers[t]&&(this.subscribers[t]=this.subscribers[t].filter((function(t){return t!==e})),this.pubSub.unsubscribe(t,e))},t.prototype.unsubscribeAll=function(){var t=this;Object.keys(this.subscribers).forEach((function(e){t.subscribers[e].forEach((function(r){t.pubSub.unsubscribe(e,r)}))}))},t}()},,,,,,function(t,e,r){"use strict";r.r(e),r.d(e,"cartWidgetController",(function(){return T}));var n,i,o,a,s=r(0),c=r(3),u=r.n(c),f=r(6);!function(t){t.DIGITAL="digital",t.PHYSICAL="physical"}(n||(n={})),function(t){t.OUT_OF_STOCK="out_of_stock",t.IN_STOCK="in_stock"}(i||(i={})),function(t){t.SECURE_PICTURE="secure_picture",t.SECURE_VIDEO="secure_video",t.SECURE_DOCUMENT="secure_document",t.SECURE_MUSIC="secure_music",t.SECURE_ARCHIVE="secure_archive"}(o||(o={})),function(t){t.DIGITAL="digital",t.PHYSICAL="physical",t.MIXED="mixed"}(a||(a={}));var d,p,l,h,b=r(5),g=r(14);function _(t){var e=u.a.cloneDeep(t);return e.items=(e.items||[]).map((function(t){return Object(s.__assign)(Object(s.__assign)(Object(s.__assign)({},t),t.product),{media:t.product.media[0]||y})})),e}!function(t){t[t.PHOTO="PHOTO"]="PHOTO",t[t.VIDEO="VIDEO"]="VIDEO"}(d||(d={})),function(t){t[t.FREE_TEXT="free_text"]="FREE_TEXT",t[t.LINK_CHANGED="link_changed"]="LINK_CHANGED",t[t.ORDER_HISTORY_VIEW_MODE_CHANGED="order_history_view_mode_changed"]="ORDER_HISTORY_VIEW_MODE_CHANGED"}(p||(p={})),function(t){t[t.DEMO="demo"]="DEMO",t[t.EMPTY_STATE="empty_state"]="EMPTY_STATE"}(l||(l={})),function(t){t.MissingZipCode="MissingZipCode",t.NoShipppingToDestination="NoShipppingToDestination",t.UnsupportedRegion="UnsupportedRegion",t.OK="OK"}(h||(h={}));var y={altText:null,height:0,width:0,mediaType:d.PHOTO,url:""},S=(function(){function t(t){this.sdkAdapter=t,this.cartChangedEventName="Cart.Changed",this.cartClearedEventName="Cart.Cleared"}t.prototype.notifyCartChange=function(t,e){this.sdkAdapter.publish(this.cartChangedEventName,Object(s.__assign)(Object(s.__assign)({},_(t)),{extraParams:e}),!1)},t.prototype.subscribeToCartChanges=function(t){this.sdkAdapter.subscribe(this.cartChangedEventName,(function(e){return t(e.data)}),!1)},t.prototype.subscribeToCartCleared=function(t){this.sdkAdapter.subscribe(this.cartClearedEventName,(function(e){return t(e.data)}),!1)}}(),r(2));var v=function(){function t(t,e,r,n){var i=this;this.siteStore=t,this.config=e,this.setProps=r,this.reportError=n,this.translations={},this.isStartReported=!1,this.onFocusTriggered=function(){i.setProps({triggerFocus:!1})},this.onAppLoaded=function(){Object(b.b)()&&!i.siteStore.isInteractive()||i.isStartReported&&i.fedopsLogger.appLoaded()},this.onIconClick=function(){return Object(s.__awaiter)(i,void 0,void 0,(function(){var t,e,r,n=this;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return t=this.cart.cartId===f.b?void 0:this.cart.cartId,e={cartId:t,cartType:this.getCartType(),itemsCount:this.getTotalQuantity(this.cart.items),viewMode:this.siteStore.viewMode.toLowerCase()},this.isOpenPopup()?(this.siteStore.experiments.enabled(f.e.stores.USE_LIGHTBOXES)?this.siteStore.windowApis.openLightbox("Mini Cart",{miniCartLayout:!0}):this.pubSubManager.publish("Minicart.Toggle",null,!1),r=this.pubSubManager.subscribe("Minicart.DidClose",(function(){n.setProps({triggerFocus:!0}),n.pubSubManager.unsubscribe("Minicart.DidClose",r)})),this.siteStore.biLogger.clickOnCartIconToOpenMiniCartSf(Object(s.__assign)(Object(s.__assign)({},e),{isNavigateCart:!1})),[3,3]):[3,1];case 1:return"cart-icon",this.siteStore.biLogger.clickToViewCartPageSf(Object(s.__assign)(Object(s.__assign)({},e),{origin:"cart-icon",isNavigateCart:!0})),[4,this.siteStore.cartActions.navigateToCart("cart-icon")];case 2:i.sent(),i.label=3;case 3:return[2]}}))}))},this.initPopup=function(){i.listenLoadedMinicartPopupAndSendCart()},this.sendAddToCartBi=function(t,e,r){var n={buttonType:S.d.AddToCart,appName:"wixstores-cart-icon",hasOptions:e,productId:t,origin:"corvid",isNavigateCart:!1,navigationClick:i.siteStore.cartActions.shouldNavigateToCart()?"cart":"mini-cart",quantity:r};return i.siteStore.biLogger.clickOnAddToCartSf(n)},this.trackEvent=function(t,e){var r={appDefId:S.a,category:"All Products",origin:"Stores",id:t,quantity:e};return i.siteStore.windowApis.trackEvent("AddToCart",r)},this.onAddToCart=function(t,e,r){return Promise.all([i.sendAddToCartBi(t,e,r),i.trackEvent(t,r)])};var o=this.siteStore.platformServices.fedOpsLoggerFactory;this.fedopsLogger=o.getLoggerForWidget({appId:S.a,widgetId:S.k.CART_ICON}),Object(b.b)()&&this.fedopsLogger.appLoadStarted(),this.isStartReported=!0,this.pubSubManager=new g.a(this.siteStore.pubSub),(this.siteStore.isSiteMode()||this.siteStore.isPreviewMode())&&this.registerEvents(),this.handleCurrencyChange(),this.siteStore.siteApis.onInstanceChanged((function(){return i.refreshData()}))}return t.prototype.handleCurrencyChange=function(){var t=this,e=this.siteStore.location.query.currency;this.siteStore.location.onChange((function(){e!==t.siteStore.location.query.currency&&(e=t.siteStore.location.query.currency,t.refreshData())}))},t.prototype.refreshData=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return this.cartPromise=this.loadCartFromServer(),[4,this.cartPromise];case 1:return t=e.sent(),this.pubSubManager.publish("Minicart.OnInitialData",t.cartSummary),this.updateCart(t.cartSummary),[2]}}))}))},t.prototype.updateCart=function(t){this.cart=t;var e=this.getTotalQuantity(this.cart.items);this.setProps(Object(s.__assign)({},this.getCountRelatedProps(e)))},t.prototype.registerEvents=function(){var t=this;this.pubSubManager.subscribe("Cart.Cleared",(function(e){e.data.cartId===t.cart.cartId&&t.updateCart({items:[]})})),this.pubSubManager.subscribe("Cart.Changed",(function(e){t.updateCart(e.data)})),this.siteStore.isMobile()||setTimeout(this.initPopup,0)},t.prototype.setInitialState=function(){return Object(s.__awaiter)(this,void 0,Promise,(function(){var t=this;return Object(s.__generator)(this,(function(e){return this.fedopsLogger.appLoadingPhaseStart("startFetching"),[2,Promise.all([this.siteStore.isSSR()?this.getAppSettingsData():this.getData(),Object(b.a)(Object(f.d)(this.siteStore.baseUrls.cartIconBaseUrl,this.siteStore.locale)),this.siteStore.getSectionUrl(S.j.CART)]).then((function(e){var r=e[0],n=e[1],i=e[2];t.fedopsLogger.appLoadingPhaseStart("processData"),t.cart=r.cartSummary||{},t.translations=n;var o=t.cart.items?t.getTotalQuantity(t.cart.items):0,a=Object(s.__assign)(Object(s.__assign)({},t.getCountRelatedProps(o)),{cartLink:u.a.get(i,"url",""),isInteractive:t.siteStore.isInteractive(),isLoaded:!0,displayText:t.getDisplayText(r.widgetSettings),triggerFocus:!1,onFocusTriggered:t.onFocusTriggered,isNavigate:!t.isOpenPopup(),onIconClick:t.onIconClick,onAppLoaded:t.onAppLoaded,cssBaseUrl:t.siteStore.baseUrls.cartIconBaseUrl,ravenUserContextOverrides:{id:t.siteStore.storeId,uuid:t.siteStore.uuid}});t.fedopsLogger.appLoadingPhaseStart("setProps"),t.setProps(a)})).then((function(){t.siteStore.isSSR()&&t.isStartReported&&t.fedopsLogger.appLoaded()})).catch(this.reportError)]}))}))},t.prototype.getDisplayText=function(t){var e,r=this.translations["CART_ICON_"+this.config.style.styleParams.numbers.cartWidgetIcon],n={};return this.siteStore.getMultiLangFields()&&!this.siteStore.getMultiLangFields().isPrimaryLanguage&&t?(n=t[(e=this.siteStore.getMultiLangFields().lang,"multilingual_"+e)],u.a.get(n,"CART_ICON_TEXT","")||r):u.a.get(this.config,"publicData.APP.CART_ICON_TEXT","")||r},t.prototype.getData=function(){return Object(s.__awaiter)(this,void 0,Promise,(function(){return Object(s.__generator)(this,(function(t){return this.cartPromise||(this.cartPromise=this.loadCartFromServer()),[2,this.cartPromise]}))}))},t.prototype.loadCartFromServer=function(){var t={query:"query getData($externalId: String!) {\n  appSettings(externalId: $externalId) {\n    widgetSettings\n  }\n  cartService {\n      cart {\n        cartId\n        items {\n          cartItemId\n          freeText {\n            title\n            value\n          }\n          product {\n            id\n            productType\n            urlPart\n            name\n            media(limit: 1) {\n              altText\n              mediaType\n              url\n              height\n              width\n            }\n            digitalProductFileItems {\n              fileType\n            }\n          }\n          optionsSelectionsValues {\n            id\n            title\n            value\n          }\n          quantity\n          inventoryQuantity\n          convertedPrices {\n            formattedComparePrice\n            formattedPrice\n          }\n        }\n        convertedTotals  {\n          itemsTotal\n          formattedItemsTotal\n        }\n      }\n    }\n}",source:"WixStoresWebClient",operationName:"getCartService",variables:{externalId:this.config.externalId||""}};return this.siteStore.httpClient.post(this.siteStore.resolveAbsoluteUrl("/"+S.l.READ_WRITE_GRAPHQL_URL),t).then((function(t){var e=t.data;return{cartSummary:_(e.cartService.cart),widgetSettings:u.a.get(e,"appSettings.widgetSettings",{})}}))},t.prototype.getAppSettingsData=function(){return Object(s.__awaiter)(this,void 0,Promise,(function(){var t;return Object(s.__generator)(this,(function(e){return this.appSettingsPromise||(t={query:"query getAppSettingsData($externalId: String!) {\n  appSettings(externalId: $externalId) {\n    widgetSettings\n  }\n}",source:"WixStoresWebClient",operationName:"getAppSettings",variables:{externalId:this.config.externalId||""}},this.appSettingsPromise=this.siteStore.httpClient.post(this.siteStore.resolveAbsoluteUrl("/"+S.l.STOREFRONT_GRAPHQL_URL),t).then((function(t){var e=t.data;return{widgetSettings:u.a.get(e,"appSettings.widgetSettings",{})}}))),[2,this.appSettingsPromise]}))}))},t.prototype.isOpenPopup=function(){var t=this.config.style.styleParams.numbers.iconLink,e=!t||2===t,r=!this.siteStore.isMobile();return e&&r},t.prototype.listenLoadedMinicartPopupAndSendCart=function(){var t=this;this.pubSubManager.subscribe("Minicart.LoadedWithoutData",(function(){return t.getData().then((function(e){t.pubSubManager.publish("Minicart.OnInitialData",e.cartSummary),t.cart=e.cartSummary}))}),!0)},t.prototype.addToCart=function(t,e,r){var n=this;if(void 0===r&&(r={}),!t)return Promise.reject();this.fedopsLogger.interactionStarted(f.c.ADD_TO_CART);var i=r.customTextFields&&r.customTextFields.map((function(t){return{customText:{title:t.title},answer:t.value}}));return this.onAddToCart(t,!!(null==r?void 0:r.choices),e),this.siteStore.cartActions.addToCart(t,r.choices||{},void 0===e?1:e,i,S.c.MINI_CART,void 0,(function(){n.fedopsLogger.interactionEnded(f.c.ADD_TO_CART)})).then((function(){return!0}))},t.prototype.addItemsToCart=function(t){var e=this;return this.fedopsLogger.interactionStarted(f.c.ADD_ITEMS_TO_CART),t.forEach((function(t){return e.onAddToCart(t.productID,!(!t.options||!t.options.choices),t.quantity)})),this.siteStore.cartActions.addItemsToCart(t,S.c.MINI_CART,void 0,(function(){e.fedopsLogger.interactionEnded(f.c.ADD_ITEMS_TO_CART)})).then((function(){return!0}))},t.prototype.unSubscribeAll=function(){return this.pubSubManager.unsubscribeAll()},t.prototype.getCartType=function(){var t=this.cart.items.some((function(t){return t.productType===n.DIGITAL})),e=this.cart.items.some((function(t){return!t.productType||t.productType===n.PHYSICAL}));return t&&e?a.MIXED:t?a.DIGITAL:a.PHYSICAL},t.prototype.getTotalQuantity=function(t){return void 0===t&&(t=[]),t.reduce((function(t,e){return t+(e.quantity||0)}),0)},t.prototype.getCountRelatedProps=function(t){return{count:t,ariaLabelLink:Object(b.c)(u.a.get(this.translations,"sr.CART_WIDGET_BUTTON_TEXT",""),{itemsCount:""+t})}},t}(),m=r(7);function T(t){var e,r,n=t.config,i=t.setProps,o=t.context,a=t.reportError;return{pageReady:function(){return r=o.siteStore,(e=new v(r,n,i,a)).setInitialState()},updateConfig:function(t,r){n.style=r.style,n.publicData=r.publicData,i({displayText:e.getDisplayText(r.publicData?r.publicData.appSettings:{})})},onBeforeUnLoad:function(){e.unSubscribeAll()},exports:function(){return Object(m.e)(t.reportError)({addToCart:function(t,r,n){return void 0===r&&(r=1),void 0===n&&(n={}),e.addToCart(""+t,r,n)},addProductsToCart:function(t){return e.addItemsToCart(t)}})}}}}])}));
//# sourceMappingURL=cartIconController.bundle.min.js.map